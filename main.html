<!doctype html>
<html lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Chat</title>
<script src="https://kit.fontawesome.com/d2d2ecd819.js" crossorigin="anonymous"></script>
<script src="js/jquery.min.js"></script>
	<script>
	
	if(localStorage.UsEr_Name_MemEArIna_UsEr_ApS2 == null){
		window.location.replace("index.html");
	}
	localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_image_selected = "none";
	</script>
	<script src="medium-zoom.min.js"></script>
  </head>
  <body style="background-color: #5F4DEE">
	<nav class="navbar navbar-dark fixed-bottom" style="background-color: #7464f0 ;box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;">	
	
	<div class="container-fluid d-inline-block d-flex">
		<div class="collapse w-100" id="media-send">
			<div class="card card-body">
				<div class="container" id="impdata">
					<img src="selectv1.png" class="rounded mx-auto d-block img-fluid" id="selector">
				</div>
				<div class="container">
					<hr>
				</div>
				<div class="d-grid">
					<button class="btn btn-primary" id="resetimgbutton">Reset</button>
				</div>
				
			</div></center>
			<br>
		</div>

      <input type="text" class="form-control me-2" placeholder="Message" style="float: right !important;width: 65%;border-radius: 25px;margin-top:4px" id="msg">
	  <button class="btn btn-light" style="width: 15%;border-radius: 25px;margin-right:5px;margin-top:4px" data-bs-toggle="collapse" data-bs-target="#media-send" aria-expanded="false" aria-controls="collapseExample"><i class="fas fa-file-image"></i></button>
      <button class="btn btn-light" type="submit" style="float: right !important;width: 15%;border-radius: 25px;margin-top:4px" id="send"><i class="fas fa-paper-plane"></i></button>

    </div>
	</nav>
	
	
	<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: #7464f0 ;box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px; font-color:red !important">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><h1 style="color:white !important;">XI Home Page</h1></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#"><b>Community Chat</b></a>
        </li><hr style="color:white">
        <li class="nav-item">
          <a class="nav-link" href="index.html"><b>Arena</b></a>
        </li><hr style="color:white">
        <li class="nav-item">
          <a class="nav-link" href="#"><b>Comments</b></a>
        </li><hr style="color:white">
        <li class="nav-item">
          <a class="nav-link" href="#"><b>Profile</b></a>
        </li><hr style="color:white">
        <li class="nav-item">
          <a class="nav-link" href="#"><b>Events</b></a>
        </li><hr style="color:white">
        <li class="nav-item">
          <a class="nav-link" id="logout"><b>Log Out</b></a>
        </li>
      </ul>
    </div>
  </div>
</nav>
	
	<br>
	<br>
	
	
	
	
	
	
	
	<div class="container">
		<div class="mt-4 p-5 rounded border border-dark" style="background-color: #FFFAFA ;" id="main-ChatBox">
<br>















		</div>
	</div>
  
  <br>
  <br>
  <br>

  
  
  
  
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script>
$( document ).ready(function() {
  $('#send').on('click', function() {
      $('input').focus();
  });
});
</script>
<script type="module">
	  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
	  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
	  const firebaseConfig = {
		apiKey: "AIzaSyCLhgz6eHJz1h75UCzJBLpKXG3ej0m8Hpc",
		authDomain: "meme-arena-x.firebaseapp.com",
		databaseURL: "https://meme-arena-x-default-rtdb.asia-southeast1.firebasedatabase.app",
		projectId: "meme-arena-x",
		storageBucket: "meme-arena-x.appspot.com",
		messagingSenderId: "1065864797805",
		appId: "1:1065864797805:web:348583a22f09f1d2f5a964",
		measurementId: "G-5QW7K75VEE"
	  };
	  const app = initializeApp(firebaseConfig);
	  const analytics = getAnalytics(app);
	  import {getDatabase, ref, set, child, onValue, get} 
	  from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
	  const db = getDatabase();
	
	get(ref(db, "TTL_MN_CHT")).then((snapshot) => {mainfn(snapshot.val())});
	const room = document.getElementById("main-ChatBox");
	var filemaybe = "";
	var filemaybe_type = "";
	function mainfn(no_of_msg)
	{
		for (let i = 0; i < no_of_msg; i++) {
			console.log(i+1);
			
			get(ref(db, "MN_CHT/"+(i+1)+"/name")).then((snapshot) => {const sub_name = snapshot.val();
				get(ref(db, "MN_CHT/"+(i+1)+"/message")).then((snapshot) => {const sub_msg = snapshot.val();
					console.log(sub_name+" : "+sub_msg);
					if (sub_name == localStorage.UsEr_Name_MemEArIna_UsEr_ApS2){
						const toAppend_msg = "<p style='text-align:right'>"+sub_msg+"</p><hr>";
						var new_msg = document.createElement("p");
						new_msg.innerHTML = toAppend_msg
						room.appendChild(new_msg);
					}
					else
					{
						const toAppend_msg = "<p>"+sub_msg+"</p><hr>";
						var new_msg = document.createElement("p");
						new_msg.innerHTML = toAppend_msg
						room.appendChild(new_msg);
					};
				});
			});
		}
	};
	
	const txtBox = document.getElementById("msg");
	document.getElementById("send").onclick = function()
	{
var isVisible = $('#media-send').is( ":visible" );
		if(isVisible){
			$('#media-send').collapse('hide');
		}
		
		
		
		// no image/video
		if(txtBox.value != "" && localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_image_selected=="none"){
		get(ref(db, "TTL_MN_CHT")).then((snapshot) => 
		{	if(localStorage.UsEr_Name_MemEArIna_UsEr_ApS2 == "Vishwash"){
				var massagetosend = "<b><b style='color:"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_Color+"'>"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2+"</b><b>></b> "+txtBox.value+"</b>";
			}
			else{
				var massagetosend = "<b><b style='color:"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_Color+"'>"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2+"</b><b>:-</b> "+txtBox.value+"</b>";
			};
			
			set(ref(db,"MN_CHT/"+(snapshot.val()+1)+"/name"),(localStorage.UsEr_Name_MemEArIna_UsEr_ApS2));
			set(ref(db,"MN_CHT/"+(snapshot.val()+1)+"/message"),(massagetosend));
			set(ref(db,"TTL_MN_CHT/"),((snapshot.val()+1)));
			txtBox.value = "";
			getElementById("resetimgbutton").click();
			$('html,body').animate({scrollTop: document.body.scrollHeight},"fast");
		});}
		//image/video
		else if( localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_image_selected=="yup!"){
		
		if(filemaybe_type == "jpg"|| filemaybe_type == "png" || filemaybe_type == "jpeg" || filemaybe_type == "gif")
		{
		
		
			get(ref(db, "TTL_MN_CHT")).then((snapshot) => 
			{	if(localStorage.UsEr_Name_MemEArIna_UsEr_ApS2 == "Vishwash"){
					var massagetosend = "<b><b style='color:"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_Color+"'>"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2+"</b><b>></b> "+txtBox.value+"</b><br><img src='"+filemaybe+"' class='rounded mx-auto d-block img-fluid'>";
				}
				else{
					var massagetosend = "<b><b style='color:"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_Color+"'>"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2+"</b><b>:-</b> "+txtBox.value+"</b><br><img src='"+filemaybe+"' class='rounded mx-auto d-block img-fluid'>";
				};
				
				set(ref(db,"MN_CHT/"+(snapshot.val()+1)+"/name"),(localStorage.UsEr_Name_MemEArIna_UsEr_ApS2));
				set(ref(db,"MN_CHT/"+(snapshot.val()+1)+"/message"),(massagetosend));
				set(ref(db,"TTL_MN_CHT/"),((snapshot.val()+1)));
				txtBox.value = "";
				getElementById("resetimgbutton").click();
				$('html,body').animate({scrollTop: document.body.scrollHeight},"fast");
			})}
		
		
		else if(filemaybe_type == "mp4"|| filemaybe_type == "avi")
		{
			console.log("donetillhere");
			get(ref(db, "TTL_MN_CHT")).then((snapshot) => 
			{	if(localStorage.UsEr_Name_MemEArIna_UsEr_ApS2 == "Vishwash"){
					var massagetosend = "<b><b style='color:"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_Color+"'>"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2+"</b><b>></b> "+txtBox.value+"</b><br><video src='"+filemaybe+"' class='rounded mx-auto d-block img-fluid' controls>";
				}
				else{
					var massagetosend = "<b><b style='color:"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_Color+"'>"+localStorage.UsEr_Name_MemEArIna_UsEr_ApS2+"</b><b>:-</b> "+txtBox.value+"</b><br><video src='"+filemaybe+"' class='rounded mx-auto d-block img-fluid' controls>";
				};

				set(ref(db,"MN_CHT/"+(snapshot.val()+1)+"/name"),(localStorage.UsEr_Name_MemEArIna_UsEr_ApS2));
				set(ref(db,"MN_CHT/"+(snapshot.val()+1)+"/message"),(massagetosend));
				set(ref(db,"TTL_MN_CHT/"),((snapshot.val()+1)));

				txtBox.value = "";
				$('html,body').animate({scrollTop: document.body.scrollHeight},"fast");
			});
		}
	}
	}
	var xtemp = 0;
	onValue(ref(db,"TTL_MN_CHT"), (snapshot) => {
			xtemp = xtemp + 1;
			if (xtemp > 1)
			{
				var newid = snapshot.val();
				get(ref(db, "MN_CHT/"+(newid)+"/name")).then((snapshot) => {var newsub_name = snapshot.val();
					get(ref(db, "MN_CHT/"+(newid)+"/message")).then((snapshot) => {var newsub_msg = snapshot.val();
						console.log(newsub_name+" : "+newsub_msg);
						if (newsub_name == localStorage.UsEr_Name_MemEArIna_UsEr_ApS2){
							const newtoAppend_msg = "<p style='text-align:right'>"+newsub_msg+"</p><hr>";
							var newnew_msg = document.createElement("p");
							newnew_msg.innerHTML = newtoAppend_msg
							room.appendChild(newnew_msg);
						}
						else
						{
							const newtoAppend_msg = "<p>"+newsub_msg+"</p><hr>";
							var newnew_msg = document.createElement("p");
							newnew_msg.innerHTML = newtoAppend_msg
							room.appendChild(newnew_msg);
						};
					});
				});
			}
		});
		
	
	document.getElementById("logout").onclick = function(){	localStorage.removeItem("UsEr_Name_MemEArIna_UsEr_ApS2");
	window.location.replace("index.html");};

	var input = document.createElement("input");
	document.getElementById("impdata").onclick = function(){
		input.setAttribute("type", "file");
		input.setAttribute("accept", "video/mp4, image/jpeg, image/png");
		input.click();
		return false;
	};
	
	
	
	input.addEventListener("change", function(){
			localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_image_selected = "yup!";
			console.log(input.value)
			const reader = new FileReader();
			var new_file = "";
			
			reader.addEventListener("load", () => {
				new_file = reader.result;
				filemaybe = new_file;
				filemaybe_type = input.value.slice(input.value.lastIndexOf('.')+1); 
				if(filemaybe_type=="jpg" || filemaybe_type=="jpg"){
					document.getElementById("impdata").innerHTML = "<img src='"+filemaybe+"' class='rounded mx-auto d-block img-fluid'>"
				}
				else if(filemaybe_type=="mp4" || filemaybe_type=="avi" || f){
					document.getElementById("impdata").innerHTML = "<video src='"+filemaybe+"' class='rounded mx-auto d-block img-fluid'>"
				};
				console.log(filemaybe);
			})
			
			reader.readAsDataURL(this.files[0]);
		});
	
	document.getElementById("resetimgbutton").onclick = function()
	{
		localStorage.UsEr_Name_MemEArIna_UsEr_ApS2_image_selected = "none";
		document.getElementById("impdata").innerHTML = "<img src=selectv1.png' class='rounded mx-auto d-block img-fluid'>";
	}
</script>
  </body>
</html>
